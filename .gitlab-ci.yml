stages:
  - build_and_test

paris:
  stage: build_and_test
  image: docker:24.0.5
  script:
    - apk add --no-cache bash make
    - cd _scripts
    - echo "ðŸ”¨ Building paris"
    - bash build "paris"
    - echo "ðŸ§ª Testing paris"
    - bash test "paris"
    - echo "Pushing to registry"
    - docker tag kgt/paris 127.0.0.1:5000/kgt/paris
    - docker push 127.0.0.1:5000/kgt/paris
  rules:
    - changes:
        - paris/**/*
        - _scripts/**/*

valentine:
  stage: build_and_test
  image: docker:24.0.5
  script:
    - apk add --no-cache bash make
    - cd _scripts
    - echo "ðŸ”¨ Building valentine"
    - bash build "valentine"
    - echo "ðŸ§ª Testing valentine"
    - bash test "valentine"
    - echo "Pushing to registry"
    - docker tag kgt/valentine 127.0.0.1:5000/kgt/valentine
    - docker push 127.0.0.1:5000/kgt/valentine
  rules:
    - changes:
        - valentine/**/*
        - _scripts/**/*

pyjedai:
  stage: build_and_test
  image: docker:24.0.5
  script:
    - apk add --no-cache bash make
    - cd _scripts
    - echo "ðŸ”¨ Building pyjedai"
    - bash build "pyjedai"
    - echo "ðŸ§ª Testing pyjedai"
    - bash test "pyjedai"
    - echo "Pushing to registry"
    - docker tag kgt/pyjedai 127.0.0.1:5000/kgt/pyjedai
    - docker push 127.0.0.1:5000/kgt/pyjedai
  rules:
    - changes:
        - pyjedai/**/*
        - _scripts/**/*

corenlp:
  stage: build_and_test
  image: docker:24.0.5
  script:
    - apk add --no-cache bash make
    - cd _scripts
    - echo "ðŸ”¨ Building corenlp"
    - bash build "corenlp"
    - echo "ðŸ§ª Testing corenlp"
    - bash test "corenlp"
    - echo "Pushing to registry"
    - docker tag kgt/corenlp 127.0.0.1:5000/kgt/corenlp
    - docker push 127.0.0.1:5000/kgt/corenlp
  rules:
    - changes:
        - corenlp/**/*
        - _scripts/**/*

